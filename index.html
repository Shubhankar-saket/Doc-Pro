<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DocEase Chatbot</title>
    <link rel="stylesheet" href="static/styles.css" />
    <script defer src="static/script.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
      /* Global Styles */
      /* Resetting some default styles */
      body, h1, h2, p, a {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            box-sizing: border-box;
        }

        body {
            background-color: #f5f6fa;
            color: #2f3542;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-image: url('static/images/chatbot_bg.jpg'); /* Replace with your image path */
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat; 
        }
      /* Chat Container Styles */
      .chat-container {
        width: 100%;
        max-width: 800px;
        margin-top: 20px;
        
        background-color: #ffffff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .chat-header {
        background-color: #3498db;
        color: white;
        padding: 15px;
        display: flex;
        align-items: center;
      }

      .chat-logo {
        width: 50px;
        height: 50px;
        margin-right: 10px;
      }

      .header-text h1 {
        margin: 0;
        font-size: 1.5rem;
      }

      .header-text p {
        margin: 0;
        font-size: 0.9rem;
      }

      .chat-box {
        height: 300px;
        overflow-y: auto;
        padding: 15px;
        background-color: #f1f1f1;
      }

      .chat-input-area {
        display: flex;
        border-top: 1px solid #ddd;
      }

      #chat-input {
        flex-grow: 1;
        border: none;
        padding: 10px;
        font-size: 1rem;
      }

      #chat-input:focus {
        outline: none;
      }

      #send-btn {
        background-color: white;
        border: none;
        color: white;
        padding: 0 15px;
        cursor: pointer;
      }

      #send-btn img {
        width: 20px;
        height: 20px;
      }

      /* Form Container Styles */
      .form-container {
        width: 100%;
        max-width: 800px;
        margin: 20px auto;
        padding: 20px;
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .form-container h2 {
        font-size: 1.5rem;
        margin-bottom: 15px;
      }

      .form-container label {
        font-weight: bold;
        margin-bottom: 5px;
        display: block;
      }

      .form-container input,
      .form-container textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
        margin-bottom: 15px;
      }

      .form-container button {
        background-color: #3498db;
        color: white;
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        font-size: 1rem;
        cursor: pointer;
      }

      .form-container button:hover {
        background-color: #3498db;
      }

      .form-container .status-message {
        margin-top: 10px;
        font-size: 1rem;
        color: green;
      }

      .form-container .error-message {
        margin-top: 10px;
        font-size: 1rem;
        color: red;
      }

      /* Sidebar Styling */
        .sidebar {
            width: 250px;
            height: 100vh;
            background-color: #3498db;
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            padding: 30px;
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar h2 {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: white;
        }

        .sidebar ul {
            list-style: none;
            padding-left: 0;
        }

        .sidebar ul li {
            margin-bottom: 15px;
        }

        .sidebar ul li a {
            color: white;
            text-decoration: none;
            font-size: 1rem;
            padding: 12px;
            display: block;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        .sidebar ul li a:hover {
            background-color: #2980b9;
        }


      /* Content Area */
      .content {
            margin-left: 250px;
            padding: 40px;
            flex: 1;
            overflow-y: auto;
        }

      #recommendations {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid #ddd;
        background-color: #f9f9f9;
      }

      #recommendations p {
        font-size: 16px;
        margin: 10px 0;
      }

      #recommendations p strong {
        color: #3498db;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
            .content {
                padding: 20px;
            }

            .container {
                padding: 20px;
            }

            .sidebar {
                width: 200px;
                padding: 20px;
            }

            .sidebar h2 {
                font-size: 1.5rem;
            }
        }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="sidebar">
      <h2>DocEase Dashboard</h2>
      <ul>
        <li><a href="/">Chatbot</a></li>
        <li><a href="pharamcy.html">Order meds</a></li>
        <li><a href="ai-translation.html">AI Translation</a></li> 
        <li><a href="urgent_cases.html">Urgent Care</a></li> 
      </ul>
    </div>

    <!-- Content Area (where the rest of your app goes) -->
    <div class="content">
      <div class="chat-container">
        <header class="chat-header">
          <img
            src="static/images/white_on_trans.png"
            alt="DocEase Logo"
            class="chat-logo"
          />
          <div class="header-text">
            <h1>Welcome to DocEase</h1>
            <p>Your personal health assistant</p>
          </div>
        </header>

        <main class="chat-box" id="chat-box">
          <!-- Messages will appear here -->
        </main>

        <div class="chat-input-area">
          <input
            type="text"
            id="chat-input"
            placeholder="Type your message..."
            autocomplete="off"
            lang="hi"
          />
          <button id="send-btn">
            <img src="static/images/send.png" alt="Send" />
          </button>
        </div>
      </div>

      <!-- Prescription Upload Section -->
      <div class="form-container">
        <h2>Upload Your Prescription</h2>
        <form id="prescription-upload-form" enctype="multipart/form-data">
          <label for="prescription">Select File:</label>
          <input
            type="file"
            id="prescription"
            name="prescription"
            accept=".png,.jpg,.jpeg,.pdf"
          />
          <button type="submit">Upload</button>
        </form>
        <div id="upload-status" class="status-message"></div>
      </div>

      <div class="form-container">
        <h2>Get Medicine Recommendations</h2>
        <form id="recommend-medicine-form">
          <label for="prescription-details">Enter Prescription Details:</label>
          <textarea
            id="prescription-details"
            rows="4"
            placeholder="Describe your prescription..."
          ></textarea>
          <button type="submit">Get Recommendations</button>
        </form>

        <!-- Div to display recommendations -->
        <div id="recommendations" class="status-message"></div>
      </div>
    </div>

    <script>
      // Upload prescription
      document.getElementById("prescription-upload-form").addEventListener("submit", async (event) => {
        event.preventDefault();
        const formData = new FormData();
        const fileInput = document.getElementById("prescription");
        formData.append("file", fileInput.files[0]);

        try {
          const response = await fetch("http://localhost:5000/upload-prescription", {
            method: "POST",
            body: formData,
          });
          const result = await response.json();
          const statusElement = document.getElementById("upload-status");
          if (response.ok) {
            statusElement.textContent = result.message;
            statusElement.className = "status-message success";
          } else {
            statusElement.textContent = result.error || "Failed to upload file.";
            statusElement.className = "status-message error";
          }
        } catch (error) {
          console.error("Error uploading prescription:", error);
          document.getElementById("upload-status").textContent =
            "An unexpected error occurred. Please try again later.";
        }
      });

      // Get medicine recommendations
      document
        .getElementById("recommend-medicine-form")
        .addEventListener("submit", async (event) => {
          event.preventDefault(); // Prevent form submission

          const prescriptionDetails = document.getElementById(
            "prescription-details"
          ).value;

          try {
            // Make the POST request to the backend
            const response = await fetch(
              "http://localhost:5000/pharmacy/recommend-medicine",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  prescription_details: prescriptionDetails,
                }),
              }
            );

            // Check if the response is OK (status 200)
            if (response.ok) {
              const result = await response.json(); // Parse the response JSON
              console.log("Backend Response:", result); // Log for debugging

              // Check if recommendations exist
              if (result.recommendations && result.recommendations.length > 0) {
                const recommendations = result.recommendations
                  .map(
                    (r) =>
                      `<p>${r.medicine} (Alternative: ${r.alternative}, Availability: ${r.availability} , Price: ${r.Price})</p>`
                  )
                  .join(""); // Join recommendations into one string

                // Display recommendations in the designated div
                document.getElementById("recommendations").innerHTML =
                  recommendations;
              } else {
                document.getElementById("recommendations").innerHTML =
                  "<p>No recommendations found.</p>";
              }
            } else {
              // Handle non-200 responses
              console.error("Request failed with status:", response.status);
              document.getElementById("recommendations").innerHTML =
                "<p>Error: Could not fetch recommendations.</p>";
            }
          } catch (error) {
            // Handle fetch or network errors
            console.error("Error fetching recommendation:", error);
            document.getElementById("recommendations").innerHTML =
              "<p>There was an error fetching the recommendations. Please try again.</p>";
          }
        });
    </script>
  </body>
</html>
